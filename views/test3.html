<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- 响应式配置 -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
    <script src="https://unpkg.com/naive-ui@2.34.4/dist/index.js"></script>
    <link rel="stylesheet" href="../css/yaya-common.css">
    <title>yaya-admin-plus</title>
    <style>
        body {
            background-color: #f5f7fa;
            font-family: v-sans, system-ui, -apple-system, sans-serif;
        }
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="yaya-container">
        <div id="app">
            <n-message-provider>
                <main-content />
            </n-message-provider>
        </div>
    </div>
    <script>
        const { createApp, ref, reactive, h, computed } = Vue;
        // 从 naive 对象中解构出需要的组件
        const {
            NButton, NInput, NCard, NSpace, NDataTable, NGrid, NGridItem,
            NForm, NFormItem, NMessageProvider, useMessage, NTag
        } = naive;

        // 定义主组件
        const MainContent = {
            setup() {
                // 获取消息提示对象
                const message = useMessage();

                // --- 1. 数据定义 ---

                // 搜索表单数据
                const searchForm = reactive({
                    communityName: '',
                    building: '',
                    unit: ''
                });

                // 模拟的房屋列表数据（真实场景下应从 API 获取）
                const rawData = [
                    { key: 1, community: '幸福家园', address: '朝阳区阳光路88号', building: '1号楼', unit: '2单元' },
                    { key: 2, community: '碧水湾', address: '海淀区清河路12号', building: '5号楼', unit: '1单元' },
                    { key: 3, community: '万科星城', address: '丰台区科技园路66号', building: '12号楼', unit: '3单元' },
                    { key: 4, community: '幸福家园', address: '朝阳区阳光路88号', building: '2号楼', unit: '1单元' },
                    { key: 5, community: '龙湖春江', address: '大兴区天宫院', building: '8号楼', unit: '2单元' },
                ];

                // 响应式表格数据
                const tableData = ref([...rawData]);

                // --- 2. 表格列配置 (包含渲染按钮) ---
                const columns = [
                    { title: '小区名称', key: 'community' },
                    { title: '小区地址', key: 'address' },
                    {
                        title: '楼栋号',
                        key: 'building',
                        render(row) {
                            // 使用 Tag 组件美化楼栋号
                            return h(NTag, { type: 'info', bordered: false }, { default: () => row.building });
                        }
                    },
                    { title: '单元号', key: 'unit' },
                    {
                        title: '操作',
                        key: 'actions',
                        width: 180,
                        // 使用 h 函数渲染按钮组
                        render(row) {
                            return h(NSpace, {}, {
                                default: () => [
                                    h(
                                        NButton,
                                        {
                                            size: 'small',
                                            type: 'primary',
                                            onClick: () => handleUpdate(row)
                                        },
                                        { default: () => '更新' }
                                    ),
                                    h(
                                        NButton,
                                        {
                                            size: 'small',
                                            type: 'error',
                                            onClick: () => handleDelete(row)
                                        },
                                        { default: () => '删除' }
                                    )
                                ]
                            });
                        }
                    }
                ];

                // --- 3. 事件处理方法 ---

                // 查询逻辑
                const handleSearch = () => {
                    tableData.value = rawData.filter(item => {
                        const matchCommunity = !searchForm.communityName || item.community.includes(searchForm.communityName);
                        const matchBuilding = !searchForm.building || item.building.includes(searchForm.building);
                        const matchUnit = !searchForm.unit || item.unit.includes(searchForm.unit);
                        return matchCommunity && matchBuilding && matchUnit;
                    });
                    message.success('查询完成');
                };

                // 重置逻辑
                const handleReset = () => {
                    searchForm.communityName = '';
                    searchForm.building = '';
                    searchForm.unit = '';
                    tableData.value = [...rawData]; // 恢复原始数据
                };

                // 更新操作
                const handleUpdate = (row) => {
                    message.info(`点击了更新：${row.community} ${row.building}`);
                    // 这里可以添加弹出模态框的逻辑
                };

                // 删除操作
                const handleDelete = (row) => {
                    // 简单模拟删除
                    tableData.value = tableData.value.filter(item => item.key !== row.key);
                    message.warning(`已删除：${row.community} ${row.building}`);
                };

                // --- 4. 模板返回 ---
                // 注意：在 CDN 模式下不能写 <template> 标签，需要返回 render 函数或者在 HTML 中挂载
                // 但为了代码可读性，Vue3 支持在组件 template 选项中写 HTML 字符串 (如果不使用构建工具)
                return {
                    searchForm,
                    tableData,
                    columns,
                    handleSearch,
                    handleReset
                };
            },
            template: `
                <div class="main-container">
                    <n-space vertical size="large">

                        <n-card title="查询条件（基于Naive UI，使用Gemini模型生成）" hoverable>
                            <n-form inline :model="searchForm" label-placement="left">
                                <n-grid :cols="4" :x-gap="24">
                                    <n-grid-item>
                                        <n-form-item label="小区名称">
                                            <n-input v-model:value="searchForm.communityName" placeholder="输入小区名" />
                                        </n-form-item>
                                    </n-grid-item>
                                    <n-grid-item>
                                        <n-form-item label="楼栋">
                                            <n-input v-model:value="searchForm.building" placeholder="例如: 1号楼" />
                                        </n-form-item>
                                    </n-grid-item>
                                    <n-grid-item>
                                        <n-form-item label="单元">
                                            <n-input v-model:value="searchForm.unit" placeholder="例如: 2单元" />
                                        </n-form-item>
                                    </n-grid-item>
                                    <n-grid-item>
                                        <n-space justify="end">
                                            <n-button type="primary" @click="handleSearch">
                                                查询
                                            </n-button>
                                            <n-button @click="handleReset">
                                                重置
                                            </n-button>
                                        </n-space>
                                    </n-grid-item>
                                </n-grid>
                            </n-form>
                        </n-card>

                        <n-card title="房屋列表" hoverable>
                            <n-data-table
                                :columns="columns"
                                :data="tableData"
                                :pagination="{ pageSize: 5 }"
                                :bordered="false"
                                :single-line="false"
                            />
                        </n-card>

                    </n-space>
                </div>
            `
        };

        const app = createApp({
            components: {
                'main-content': MainContent,
                'n-message-provider': NMessageProvider
            }
        });

        // 注册 Naive UI 组件
        // 注意：在 CDN 模式下，组件是 app.use(naive) 这样注册比较麻烦，
        // 推荐在组件 components 选项中局部注册，或者如下全局挂载：
        app.component('n-button', NButton);
        app.component('n-input', NInput);
        app.component('n-card', NCard);
        app.component('n-space', NSpace);
        app.component('n-data-table', NDataTable);
        app.component('n-grid', NGrid);
        app.component('n-grid-item', NGridItem);
        app.component('n-form', NForm);
        app.component('n-form-item', NFormItem);
        app.component('n-tag', NTag);

        app.mount('#app');
    </script>
</body>
</html>